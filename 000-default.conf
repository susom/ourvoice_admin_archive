ServerName foo
<VirtualHost *:80>

  LogLevel info
  LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" combined
  ErrorLog /dev/stdout
  CustomLog /dev/stdout combined

  # Unset to make sure clients can't control these
  RequestHeader unset X-Remote-User
  RequestHeader unset X-Remote-User-Name
  RequestHeader unset X-Remote-User-Email
  RequestHeader unset X-Remote-User-FirstName
  RequestHeader unset X-Remote-User-LastNamne

  # Set header to be used for REMOTE_USER variable in REDCap
  RequestHeader set X-Remote-User "%{OIDC_CLAIM_principal}e"

  # strip @stanford.edu from principal for stanford users so we don't have to change users
  RequestHeader edit X-Remote-User \@stanford.edu$ ""
  RequestHeader edit X-Remote-User "\(null\)" ""

  RequestHeader set X-Remote-User-Name %{OIDC_CLAIM_name}e
  RequestHeader set X-Remote-User-Email %{OIDC_CLAIM_email}e
  RequestHeader set X-Remote-User-FirstName %{OIDC_CLAIM_given_name}e
  RequestHeader set X-Remote-User-LastName %{OIDC_CLAIM_surname}e
  # RequestHeader set X-Forwarded-Proto https
  # RequestHeader set X-Forwarded-Port 443

  # Load OIDC
  OIDCClientID garrick-test
  OIDCProviderMetadataURL https://idp-proxy.med.stanford.edu/auth/realms/med-all/.well-known/openid-configuration
  OIDCRedirectURI https://localhost:8111/oauth2callback

  OIDCScope "openid email"
  OIDCRemoteUserClaim principal
  OIDCPassClaimsAs environment

  OIDCCryptoPassphrase 01234567890123456789
  #OIDCClientSecret OIDC_CLIENT_SECRET
  Include /secrets/ourvoice-oidc-client-secret


  DocumentRoot /var/www/html
  DirectoryIndex index.php index.html
  Options -Indexes


</VirtualHost>
